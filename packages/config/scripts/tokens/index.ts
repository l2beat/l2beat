import { EthereumAddress } from '@l2beat/shared'
import { config as dotenv } from 'dotenv'
import { providers } from 'ethers'
import { writeFileSync } from 'fs'

import { tokenList } from '../../src'
import { TokenInfo } from '../../src/tokens/types'
import { getEnv } from '../checkVerifiedContracts/utils'
import { getTokenInfo } from './addTokens'

async function main() {
  const provider = new providers.AlchemyProvider(
    'homestead',
    getEnv('CONFIG_ALCHEMY_API_KEY'),
  )

  const token: TokenInfo = await getTokenInfo(
    provider,
    EthereumAddress('0x582d872a1b094fc48f5de31d3b73f2d9be47def1'),
    'other',
  )

  const newList = [...tokenList, token].sort((a, b) =>
    a.name.localeCompare(b.name),
  )

  const comment =
    'This file was autogenerated. Do not modify it by hand, instead use: yarn tokens:add <address> <type>'

  writeFileSync(
    'src/tokens/tokenList.json',
    JSON.stringify({ comment, tokens: newList }, null, 2),
  )
}

dotenv()
main().catch((e) => {
  console.error(e)
})
